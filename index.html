<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Chat</title>
<style>
  body {
    background:#111;
    font-family:sans-serif;
    color:#fff;
    display:flex;
    justify-content:center;
    align-items:center;
    height:100vh;
    margin:0;
  }
  .chat-container {
    width:360px;
    height:600px;
    background:#0b141a;
    display:flex;
    flex-direction:column;
    border-radius:8px;
    overflow:hidden;
    box-shadow:0 0 10px rgba(0,0,0,.6);
  }
  .header {
    background:#202c33;
    padding:10px;
    text-align:center;
    font-weight:bold;
  }
  .status {
    font-size:12px;
    color:#aaa;
  }
  .messages {
    flex:1;
    overflow-y:auto;
    padding:10px;
  }
  .msg {
    margin:6px 0;
    max-width:80%;
    padding:6px 8px;
    border-radius:6px;
    line-height:1.3;
    word-break:break-word;
  }
  .ish { background:#005c4b; align-self:flex-end; }
  .bil { background:#202c33; align-self:flex-start; }
  .footer { display:flex; background:#202c33; padding:6px; }
  .footer input { flex:1; padding:6px; border:none; border-radius:4px; background:#2a3942; color:#fff; }
  .footer button { margin-left:4px; background:#00a884; border:none; color:#fff; padding:0 12px; border-radius:4px; cursor:pointer; }

  /* Overlay for user selection */
  #overlay {
    position:fixed;
    top:0; left:0; right:0; bottom:0;
    background:rgba(0,0,0,0.85);
    display:flex;
    justify-content:center;
    align-items:center;
    flex-direction:column;
    z-index:100;
  }
  #overlay h2 { margin-bottom:20px; }
  #overlay button {
    margin:10px;
    padding:12px 24px;
    background:#00a884;
    border:none;
    color:#fff;
    border-radius:6px;
    cursor:pointer;
    font-size:16px;
  }
</style>
</head>
<body>
<div id="overlay">
  <h2>Select User</h2>
  <button onclick="selectUser('Ishu')">Ishu</button>
  <button onclick="selectUser('Billi')">Billi</button>
</div>

<div class="chat-container">
  <div class="header">
    <div>Chat</div>
    <div class="status" id="status">Select user…</div>
  </div>
  <div class="messages" id="messages"></div>
  <div class="footer">
    <input id="msgInput" placeholder="Type a message…" disabled />
    <button id="sendBtn" disabled>Send</button>
  </div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-app.js";
import { getDatabase, ref, push, onValue, update, serverTimestamp } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-database.js";

// === Firebase config ===
const firebaseConfig = {
  apiKey: "AIzaSyAyLfQR-k8L45imDdx0N-5pw8P43_pmJ8E",
  authDomain: "youandme12345-d1d17.firebaseapp.com",
  projectId: "youandme12345-d1d17",
  storageBucket: "youandme12345-d1d17.firebasestorage.app",
  messagingSenderId: "500541583420",
  appId: "1:500541583420:web:ec35f7355884fb6e345339",
  databaseURL: "https://youandme12345-d1d17-default-rtdb.firebaseio.com/"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

const messagesRef = ref(db, "messages");
const typingRef = ref(db, "typing");

const messagesDiv = document.getElementById("messages");
const input = document.getElementById("msgInput");
const sendBtn = document.getElementById("sendBtn");
const status = document.getElementById("status");
const overlay = document.getElementById("overlay");

let currentUser = null;

// User selection popup
window.selectUser = function(user){
  currentUser = user;
  overlay.style.display = "none";
  input.disabled = false;
  sendBtn.disabled = false;
  status.textContent = `${currentUser} online`;
  update(typingRef, { [currentUser]: false });
}

// Send message
sendBtn.addEventListener("click", sendMessage);
input.addEventListener("keydown", e => { if(e.key==='Enter') sendMessage(); });
function sendMessage(){
  if(!input.value.trim() || !currentUser) return;
  push(messagesRef, { user: currentUser, text: input.value.trim(), timestamp: serverTimestamp() });
  input.value="";
  update(typingRef, { [currentUser]: false });
}

// Typing indicator
let typingTimeout;
input.addEventListener("input", ()=>{
  if(!currentUser) return;
  update(typingRef, { [currentUser]: true });
  clearTimeout(typingTimeout);
  typingTimeout = setTimeout(()=>update(typingRef,{[currentUser]:false}),1500);
});

onValue(typingRef, snap=>{
  const val = snap.val()||{};
  const other = currentUser==='Ishu'?'Billi':'Ishu';
  if(val[other]) status.textContent = `${other} typing…`;
  else if(currentUser) status.textContent = `${other} online`;
});

// Load messages
onValue(messagesRef, snap=>{
  messagesDiv.innerHTML="";
  snap.forEach(child=>{
    const msg = child.val();
    const div = document.createElement("div");
    div.classList.add("msg");
    div.classList.add(msg.user==='Ishu'?'ish':'bil');
    div.textContent = msg.user + ": " + msg.text;
    messagesDiv.appendChild(div);
  });
  messagesDiv.scrollTop = messagesDiv.scrollHeight;
});
</script>
</body>
</html>ṭ
